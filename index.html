<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>QA Interview Demo with Mock API</title>
<style>
body { font-family: Arial; margin: 20px; }
.hidden { display: none; }
.product { border: 1px solid #ccc; margin: 5px; padding: 10px; }
</style>
</head>
<body>
<h1>QA Interview Demo (Web + API)</h1>
<div id="page-register">
  <h2>Register</h2>
  <input id="reg-first" placeholder="First Name"><br>
  <input id="reg-last" placeholder="Last Name"><br>
  <input id="reg-email" placeholder="Email"><br>
  <input id="reg-pass" placeholder="Password" type="password"><br>
  <input id="reg-confirm" placeholder="Confirm Password" type="password"><br>
  <input id="reg-dob" placeholder="Date of Birth (YYYY-MM-DD)"><br>
  <select id="reg-gender"><option>Male</option><option>Female</option></select><br>
  <button onclick="register()">Register</button>
  <div id="reg-msg"></div>
</div>

<div id="page-products" class="hidden">
  <h2>Products</h2>
  <div id="product-list"></div>
  <button onclick="checkout()">Checkout</button>
</div>

<div id="page-checkout" class="hidden">
  <h2>Checkout</h2>
  <div id="order-summary"></div>
  <button onclick="goPayment()">Proceed to Payment</button>
</div>

<div id="page-payment" class="hidden">
  <h2>Payment</h2>
  Method:
  <select id="pay-method">
    <option>Credit Card</option>
    <option>Bank Transfer</option>
    <option>e-Wallet</option>
  </select><br>
  Card Number (for Credit Card only): <input id="card-num"><br>
  <button onclick="processPayment()">Pay Now</button>
  <div id="pay-msg"></div>
</div>

<div id="page-history" class="hidden">
  <h2>Order History</h2>
  <div id="history-list"></div>
</div>

<script>
let orders = [];
let products = [];

// Mock API Simulation
function apiRegister(data){
  return new Promise(resolve=>{
    // ❌ Bug: No proper email/password validation
    resolve({status:"success", message:"Register Success"});
  });
}

function apiGetProducts(){
  return new Promise(resolve=>{
    // ❌ Bug: Wrong price data from backend
    resolve([
      {name:"T-Shirt", price:120}, // Should be 100
      {name:"Shoes", price:550},   // Should be 500
      {name:"Hat", price:60}       // Should be 50
    ]);
  });
}

function apiCheckout(cart){
  return new Promise(resolve=>{
    // ❌ Bug: qty=0 allowed
    let total = 0;
    cart.forEach(item=> total += item.qty * item.price);
    resolve({total: total});
  });
}

function apiPayment(method, amount, cardNum){
  return new Promise(resolve=>{
    // ❌ Bug: Credit card not validated
    if(method === "Bank Transfer"){
      resolve({status:"success", recorded:false}); // ❌ Not recorded
    } else {
      resolve({status:"success", recorded:true});
    }
  });
}

function apiGetOrders(){
  return new Promise(resolve=>{
    // ❌ Bug: Duplicate merges
    resolve(orders);
  });
}

// Page functions
function register(){
  const data = {
    first: document.getElementById('reg-first').value,
    last: document.getElementById('reg-last').value,
    email: document.getElementById('reg-email').value,
    pass: document.getElementById('reg-pass').value,
    dob: document.getElementById('reg-dob').value,
    gender: document.getElementById('reg-gender').value
  };
  apiRegister(data).then(res=>{
    document.getElementById('reg-msg').innerText = res.message;
    if(res.status === "success"){
      document.getElementById('page-register').classList.add('hidden');
      loadProducts();
    }
  });
}

function loadProducts(){
  apiGetProducts().then(items=>{
    products = items;
    const listDiv = document.getElementById('product-list');
    listDiv.innerHTML = "";
    items.forEach((p,i)=>{
      listDiv.innerHTML += `<div class="product">
        ${p.name} (${p.price} THB)<br>
        Qty: <input id="qty-${i}" type="number" value="1">
      </div>`;
    });
    document.getElementById('page-products').classList.remove('hidden');
  });
}

function checkout(){
  const cart = products.map((p,i)=>{
    return {name:p.name, price:p.price, qty:parseInt(document.getElementById(`qty-${i}`).value)};
  });
  apiCheckout(cart).then(res=>{
    document.getElementById('order-summary').innerText = `Total: ${res.total} THB`;
    document.getElementById('page-products').classList.add('hidden');
    document.getElementById('page-checkout').classList.remove('hidden');
  });
}

function goPayment(){
  document.getElementById('page-checkout').classList.add('hidden');
  document.getElementById('page-payment').classList.remove('hidden');
}

function processPayment(){
  const method = document.getElementById('pay-method').value;
  const card = document.getElementById('card-num').value;
  const amountText = document.getElementById('order-summary').innerText;
  const amount = parseInt(amountText.replace(/[^0-9]/g,""));
  
  apiPayment(method, amount, card).then(res=>{
    document.getElementById('pay-msg').innerText = "Payment " + res.status;
    if(res.recorded){
      orders.push({item:"Order via "+method, amount:amount});
    }
    showHistory();
    document.getElementById('page-payment').classList.add('hidden');
    document.getElementById('page-history').classList.remove('hidden');
  });
}

function showHistory(){
  apiGetOrders().then(hist=>{
    document.getElementById('history-list').innerHTML = hist.map(o=> `${o.item} - ${o.amount} THB`).join("<br>");
  });
}
</script>
</body>
</html>
